<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Log In</title>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <script src="http://cdn.jsdelivr.net/jquery.validation/1.14.0/jquery.validate.js"></script>
  <script>
  $(document).ready(function(){
      var but  = document.getElementById("submit_form");
      but.addEventListener("click", loginValidate);

      var show = document.getElementById("show");
      show.addEventListener("click", showCreate);

      var hide = document.getElementById('hide');
      hide.addEventListener("click", showHide);

      document.getElementById("submit_user").addEventListener("click", createUser);
  });

  function showCreate(evt){
      evt.target.style.display = "none";
      document.getElementById("login_form").style.display = "none";
      document.getElementById("create_user").style.display = "block";
      document.getElementById("hide").style.display = "block";
  }

  function showHide(evt){
      evt.target.style.display = "none";
      document.getElementById("login_form").style.display = "block";
      document.getElementById("create_user").style.display = "none";
      document.getElementById("show").style.display = "block";
  }

   function loginValidate(){
    var n = document.getElementById("uName").value;
    var p = document.getElementById("pWord").value;
    var json = '{ "n" : "' + n + '", "p" : "' + p + '"}';
    
    ajaxCall("POST",{method:"login",a:"login", data: json}, callbackLogin);
   }

  function callbackLogin(data, status){
      if(data != -1){
        location.href = "./room.html";
      }
      else{
        failedLogin();
      }
  }

  function createUser(){
      var u = document.getElementById("newUser").value,
              p = document.getElementById("pass").value,
              cp = document.getElementById("cPass").value;

      var json = '{ "u" : "' + u + '" , "p" : "' + p + '" , "cp" : "' + cp + '"}';

      ajaxCall("POST", {method: "createUser", a: "login", data: json}, callbackCreateUser);
  }

  function callbackCreateUser(data, status) {
      if(data === 1){
          location.href = "./room.html";
      }
  }

  function ajaxCall(GetPost,d,callback){
    $.ajax({
        type: GetPost,
        async: true,
        cache:false,
        url: "mid.php",
        data: d,  
        dataType: "json",
        success: callback
    });
  }

  //handle failed login
  function failedLogin(){
    
  }
  </script>

  <style>
  form { 
    margin: 10px;
  }

  #create_user, #hide{
    display: none;
  }

  </style>
</head>
<body>
  <form id="login_form" method="post" onsubmit="return loginValidate();">
    <label for="uName">User: </label>
      <input type="text" name="uName" id="uName" required/> 
    <label for="pWord">Password: </label>
      <input type="text" name="pWord" id="pWord" required/>
    <input type="hidden" name='method' value="login" />
    <button type="button" id="submit_form">Login</button>
  </form>
  <script>
    $("#login_form").validate();
  </script>
  <form id="create_user">
    <label for="newUser">Username: </label>
      <input type="text" name="newUser" id="newUser" />
    <label for="pass">Password: </label>
      <input type="text" name="pass" id="pass" />
    <label for="cPass">Confirm PW: </label>
      <input type="text" name="cPass" id="cPass" />
    <button type="button" id="submit_user">Create</button>
  </form>
  <script>
      $("#create_user").validate();
  </script>
  <br/><br/>
  <button type="button" id="show">Create new user</button>
  <button type="button" id="hide">Login as existing</button>
</body>
</html>
